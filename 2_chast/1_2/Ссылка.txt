Всё решение описано в подробностях в pdf файле 


https://docs.google.com/spreadsheets/d/1G6wYo-qpM-DiWI28HYQCdVP2koRuuDAzWHaIIdWi3zI/edit?usp=sharing